{"remainingRequest":"C:\\Users\\liuli\\source\\repos\\github\\WalkingTec.Mvvm\\WebApplication2\\ClientApp\\node_modules\\babel-loader\\lib\\index.js??ref--4-oneOf-1-1!C:\\Users\\liuli\\source\\repos\\github\\WalkingTec.Mvvm\\WebApplication2\\ClientApp\\node_modules\\rc-form\\es\\createFieldsStore.js","dependencies":[{"path":"C:\\Users\\liuli\\source\\repos\\github\\WalkingTec.Mvvm\\WebApplication2\\ClientApp\\node_modules\\rc-form\\es\\createFieldsStore.js","mtime":499162500000},{"path":"C:\\Users\\liuli\\source\\repos\\github\\WalkingTec.Mvvm\\WebApplication2\\ClientApp\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\liuli\\source\\repos\\github\\WalkingTec.Mvvm\\WebApplication2\\ClientApp\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport set from 'lodash/set';\nimport createFormField, { isFormField } from './createFormField';\nimport { flattenFields, getErrorStrs, startsWith } from './utils';\n\nfunction partOf(a, b) {\n  return b.indexOf(a) === 0 && ['.', '['].indexOf(b[a.length]) !== -1;\n}\n\nfunction internalFlattenFields(fields) {\n  return flattenFields(fields, function (_, node) {\n    return isFormField(node);\n  }, 'You must wrap field data with `createFormField`.');\n}\n\nvar FieldsStore = function () {\n  function FieldsStore(fields) {\n    _classCallCheck(this, FieldsStore);\n\n    _initialiseProps.call(this);\n\n    this.fields = internalFlattenFields(fields);\n    this.fieldsMeta = {};\n  }\n\n  _createClass(FieldsStore, [{\n    key: 'updateFields',\n    value: function updateFields(fields) {\n      this.fields = internalFlattenFields(fields);\n    }\n  }, {\n    key: 'flattenRegisteredFields',\n    value: function flattenRegisteredFields(fields) {\n      var validFieldsName = this.getAllFieldsName();\n      return flattenFields(fields, function (path) {\n        return validFieldsName.indexOf(path) >= 0;\n      }, 'You cannot set a form field before rendering a field associated with the value.');\n    }\n  }, {\n    key: 'setFields',\n    value: function setFields(fields) {\n      var _this = this;\n\n      var fieldsMeta = this.fieldsMeta;\n\n      var nowFields = _extends({}, this.fields, fields);\n\n      var nowValues = {};\n      Object.keys(fieldsMeta).forEach(function (f) {\n        nowValues[f] = _this.getValueFromFields(f, nowFields);\n      });\n      Object.keys(nowValues).forEach(function (f) {\n        var value = nowValues[f];\n\n        var fieldMeta = _this.getFieldMeta(f);\n\n        if (fieldMeta && fieldMeta.normalize) {\n          var nowValue = fieldMeta.normalize(value, _this.getValueFromFields(f, _this.fields), nowValues);\n\n          if (nowValue !== value) {\n            nowFields[f] = _extends({}, nowFields[f], {\n              value: nowValue\n            });\n          }\n        }\n      });\n      this.fields = nowFields;\n    }\n  }, {\n    key: 'resetFields',\n    value: function resetFields(ns) {\n      var fields = this.fields;\n      var names = ns ? this.getValidFieldsFullName(ns) : this.getAllFieldsName();\n      return names.reduce(function (acc, name) {\n        var field = fields[name];\n\n        if (field && 'value' in field) {\n          acc[name] = {};\n        }\n\n        return acc;\n      }, {});\n    }\n  }, {\n    key: 'setFieldMeta',\n    value: function setFieldMeta(name, meta) {\n      this.fieldsMeta[name] = meta;\n    }\n  }, {\n    key: 'getFieldMeta',\n    value: function getFieldMeta(name) {\n      this.fieldsMeta[name] = this.fieldsMeta[name] || {};\n      return this.fieldsMeta[name];\n    }\n  }, {\n    key: 'getValueFromFields',\n    value: function getValueFromFields(name, fields) {\n      var field = fields[name];\n\n      if (field && 'value' in field) {\n        return field.value;\n      }\n\n      var fieldMeta = this.getFieldMeta(name);\n      return fieldMeta && fieldMeta.initialValue;\n    }\n  }, {\n    key: 'getValidFieldsName',\n    value: function getValidFieldsName() {\n      var _this2 = this;\n\n      var fieldsMeta = this.fieldsMeta;\n      return fieldsMeta ? Object.keys(fieldsMeta).filter(function (name) {\n        return !_this2.getFieldMeta(name).hidden;\n      }) : [];\n    }\n  }, {\n    key: 'getAllFieldsName',\n    value: function getAllFieldsName() {\n      var fieldsMeta = this.fieldsMeta;\n      return fieldsMeta ? Object.keys(fieldsMeta) : [];\n    }\n  }, {\n    key: 'getValidFieldsFullName',\n    value: function getValidFieldsFullName(maybePartialName) {\n      var maybePartialNames = Array.isArray(maybePartialName) ? maybePartialName : [maybePartialName];\n      return this.getValidFieldsName().filter(function (fullName) {\n        return maybePartialNames.some(function (partialName) {\n          return fullName === partialName || startsWith(fullName, partialName) && ['.', '['].indexOf(fullName[partialName.length]) >= 0;\n        });\n      });\n    }\n  }, {\n    key: 'getFieldValuePropValue',\n    value: function getFieldValuePropValue(fieldMeta) {\n      var name = fieldMeta.name,\n          getValueProps = fieldMeta.getValueProps,\n          valuePropName = fieldMeta.valuePropName;\n      var field = this.getField(name);\n      var fieldValue = 'value' in field ? field.value : fieldMeta.initialValue;\n\n      if (getValueProps) {\n        return getValueProps(fieldValue);\n      }\n\n      return _defineProperty({}, valuePropName, fieldValue);\n    }\n  }, {\n    key: 'getField',\n    value: function getField(name) {\n      return _extends({}, this.fields[name], {\n        name: name\n      });\n    }\n  }, {\n    key: 'getNotCollectedFields',\n    value: function getNotCollectedFields() {\n      var _this3 = this;\n\n      var fieldsName = this.getValidFieldsName();\n      return fieldsName.filter(function (name) {\n        return !_this3.fields[name];\n      }).map(function (name) {\n        return {\n          name: name,\n          dirty: false,\n          value: _this3.getFieldMeta(name).initialValue\n        };\n      }).reduce(function (acc, field) {\n        return set(acc, field.name, createFormField(field));\n      }, {});\n    }\n  }, {\n    key: 'getNestedAllFields',\n    value: function getNestedAllFields() {\n      var _this4 = this;\n\n      return Object.keys(this.fields).reduce(function (acc, name) {\n        return set(acc, name, createFormField(_this4.fields[name]));\n      }, this.getNotCollectedFields());\n    }\n  }, {\n    key: 'getFieldMember',\n    value: function getFieldMember(name, member) {\n      return this.getField(name)[member];\n    }\n  }, {\n    key: 'getNestedFields',\n    value: function getNestedFields(names, getter) {\n      var fields = names || this.getValidFieldsName();\n      return fields.reduce(function (acc, f) {\n        return set(acc, f, getter(f));\n      }, {});\n    }\n  }, {\n    key: 'getNestedField',\n    value: function getNestedField(name, getter) {\n      var fullNames = this.getValidFieldsFullName(name);\n\n      if (fullNames.length === 0 || // Not registered\n      fullNames.length === 1 && fullNames[0] === name // Name already is full name.\n      ) {\n          return getter(name);\n        }\n\n      var isArrayValue = fullNames[0][name.length] === '[';\n      var suffixNameStartIndex = isArrayValue ? name.length : name.length + 1;\n      return fullNames.reduce(function (acc, fullName) {\n        return set(acc, fullName.slice(suffixNameStartIndex), getter(fullName));\n      }, isArrayValue ? [] : {});\n    }\n  }, {\n    key: 'isValidNestedFieldName',\n    // @private\n    // BG: `a` and `a.b` cannot be use in the same form\n    value: function isValidNestedFieldName(name) {\n      var names = this.getAllFieldsName();\n      return names.every(function (n) {\n        return !partOf(n, name) && !partOf(name, n);\n      });\n    }\n  }, {\n    key: 'clearField',\n    value: function clearField(name) {\n      delete this.fields[name];\n      delete this.fieldsMeta[name];\n    }\n  }]);\n\n  return FieldsStore;\n}();\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this5 = this;\n\n  this.setFieldsInitialValue = function (initialValues) {\n    var flattenedInitialValues = _this5.flattenRegisteredFields(initialValues);\n\n    var fieldsMeta = _this5.fieldsMeta;\n    Object.keys(flattenedInitialValues).forEach(function (name) {\n      if (fieldsMeta[name]) {\n        _this5.setFieldMeta(name, _extends({}, _this5.getFieldMeta(name), {\n          initialValue: flattenedInitialValues[name]\n        }));\n      }\n    });\n  };\n\n  this.getAllValues = function () {\n    var fieldsMeta = _this5.fieldsMeta,\n        fields = _this5.fields;\n    return Object.keys(fieldsMeta).reduce(function (acc, name) {\n      return set(acc, name, _this5.getValueFromFields(name, fields));\n    }, {});\n  };\n\n  this.getFieldsValue = function (names) {\n    return _this5.getNestedFields(names, _this5.getFieldValue);\n  };\n\n  this.getFieldValue = function (name) {\n    var fields = _this5.fields;\n    return _this5.getNestedField(name, function (fullName) {\n      return _this5.getValueFromFields(fullName, fields);\n    });\n  };\n\n  this.getFieldsError = function (names) {\n    return _this5.getNestedFields(names, _this5.getFieldError);\n  };\n\n  this.getFieldError = function (name) {\n    return _this5.getNestedField(name, function (fullName) {\n      return getErrorStrs(_this5.getFieldMember(fullName, 'errors'));\n    });\n  };\n\n  this.isFieldValidating = function (name) {\n    return _this5.getFieldMember(name, 'validating');\n  };\n\n  this.isFieldsValidating = function (ns) {\n    var names = ns || _this5.getValidFieldsName();\n\n    return names.some(function (n) {\n      return _this5.isFieldValidating(n);\n    });\n  };\n\n  this.isFieldTouched = function (name) {\n    return _this5.getFieldMember(name, 'touched');\n  };\n\n  this.isFieldsTouched = function (ns) {\n    var names = ns || _this5.getValidFieldsName();\n\n    return names.some(function (n) {\n      return _this5.isFieldTouched(n);\n    });\n  };\n};\n\nexport default function createFieldsStore(fields) {\n  return new FieldsStore(fields);\n}",{"version":3,"sources":["C:\\Users\\liuli\\source\\repos\\github\\WalkingTec.Mvvm\\WebApplication2\\ClientApp\\node_modules\\rc-form\\es\\createFieldsStore.js"],"names":["_defineProperty","_extends","_classCallCheck","_createClass","set","createFormField","isFormField","flattenFields","getErrorStrs","startsWith","partOf","a","b","indexOf","length","internalFlattenFields","fields","_","node","FieldsStore","_initialiseProps","call","fieldsMeta","key","value","updateFields","flattenRegisteredFields","validFieldsName","getAllFieldsName","path","setFields","_this","nowFields","nowValues","Object","keys","forEach","f","getValueFromFields","fieldMeta","getFieldMeta","normalize","nowValue","resetFields","ns","names","getValidFieldsFullName","reduce","acc","name","field","setFieldMeta","meta","initialValue","getValidFieldsName","_this2","filter","hidden","maybePartialName","maybePartialNames","Array","isArray","fullName","some","partialName","getFieldValuePropValue","getValueProps","valuePropName","getField","fieldValue","getNotCollectedFields","_this3","fieldsName","map","dirty","getNestedAllFields","_this4","getFieldMember","member","getNestedFields","getter","getNestedField","fullNames","isArrayValue","suffixNameStartIndex","slice","isValidNestedFieldName","every","n","clearField","_this5","setFieldsInitialValue","initialValues","flattenedInitialValues","getAllValues","getFieldsValue","getFieldValue","getFieldsError","getFieldError","isFieldValidating","isFieldsValidating","isFieldTouched","isFieldsTouched","createFieldsStore"],"mappings":"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","sourcesContent":["import _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport set from 'lodash/set';\nimport createFormField, { isFormField } from './createFormField';\nimport { flattenFields, getErrorStrs, startsWith } from './utils';\n\nfunction partOf(a, b) {\n  return b.indexOf(a) === 0 && ['.', '['].indexOf(b[a.length]) !== -1;\n}\n\nfunction internalFlattenFields(fields) {\n  return flattenFields(fields, function (_, node) {\n    return isFormField(node);\n  }, 'You must wrap field data with `createFormField`.');\n}\n\nvar FieldsStore = function () {\n  function FieldsStore(fields) {\n    _classCallCheck(this, FieldsStore);\n\n    _initialiseProps.call(this);\n\n    this.fields = internalFlattenFields(fields);\n    this.fieldsMeta = {};\n  }\n\n  _createClass(FieldsStore, [{\n    key: 'updateFields',\n    value: function updateFields(fields) {\n      this.fields = internalFlattenFields(fields);\n    }\n  }, {\n    key: 'flattenRegisteredFields',\n    value: function flattenRegisteredFields(fields) {\n      var validFieldsName = this.getAllFieldsName();\n      return flattenFields(fields, function (path) {\n        return validFieldsName.indexOf(path) >= 0;\n      }, 'You cannot set a form field before rendering a field associated with the value.');\n    }\n  }, {\n    key: 'setFields',\n    value: function setFields(fields) {\n      var _this = this;\n\n      var fieldsMeta = this.fieldsMeta;\n      var nowFields = _extends({}, this.fields, fields);\n      var nowValues = {};\n      Object.keys(fieldsMeta).forEach(function (f) {\n        nowValues[f] = _this.getValueFromFields(f, nowFields);\n      });\n      Object.keys(nowValues).forEach(function (f) {\n        var value = nowValues[f];\n        var fieldMeta = _this.getFieldMeta(f);\n        if (fieldMeta && fieldMeta.normalize) {\n          var nowValue = fieldMeta.normalize(value, _this.getValueFromFields(f, _this.fields), nowValues);\n          if (nowValue !== value) {\n            nowFields[f] = _extends({}, nowFields[f], {\n              value: nowValue\n            });\n          }\n        }\n      });\n      this.fields = nowFields;\n    }\n  }, {\n    key: 'resetFields',\n    value: function resetFields(ns) {\n      var fields = this.fields;\n\n      var names = ns ? this.getValidFieldsFullName(ns) : this.getAllFieldsName();\n      return names.reduce(function (acc, name) {\n        var field = fields[name];\n        if (field && 'value' in field) {\n          acc[name] = {};\n        }\n        return acc;\n      }, {});\n    }\n  }, {\n    key: 'setFieldMeta',\n    value: function setFieldMeta(name, meta) {\n      this.fieldsMeta[name] = meta;\n    }\n  }, {\n    key: 'getFieldMeta',\n    value: function getFieldMeta(name) {\n      this.fieldsMeta[name] = this.fieldsMeta[name] || {};\n      return this.fieldsMeta[name];\n    }\n  }, {\n    key: 'getValueFromFields',\n    value: function getValueFromFields(name, fields) {\n      var field = fields[name];\n      if (field && 'value' in field) {\n        return field.value;\n      }\n      var fieldMeta = this.getFieldMeta(name);\n      return fieldMeta && fieldMeta.initialValue;\n    }\n  }, {\n    key: 'getValidFieldsName',\n    value: function getValidFieldsName() {\n      var _this2 = this;\n\n      var fieldsMeta = this.fieldsMeta;\n\n      return fieldsMeta ? Object.keys(fieldsMeta).filter(function (name) {\n        return !_this2.getFieldMeta(name).hidden;\n      }) : [];\n    }\n  }, {\n    key: 'getAllFieldsName',\n    value: function getAllFieldsName() {\n      var fieldsMeta = this.fieldsMeta;\n\n      return fieldsMeta ? Object.keys(fieldsMeta) : [];\n    }\n  }, {\n    key: 'getValidFieldsFullName',\n    value: function getValidFieldsFullName(maybePartialName) {\n      var maybePartialNames = Array.isArray(maybePartialName) ? maybePartialName : [maybePartialName];\n      return this.getValidFieldsName().filter(function (fullName) {\n        return maybePartialNames.some(function (partialName) {\n          return fullName === partialName || startsWith(fullName, partialName) && ['.', '['].indexOf(fullName[partialName.length]) >= 0;\n        });\n      });\n    }\n  }, {\n    key: 'getFieldValuePropValue',\n    value: function getFieldValuePropValue(fieldMeta) {\n      var name = fieldMeta.name,\n          getValueProps = fieldMeta.getValueProps,\n          valuePropName = fieldMeta.valuePropName;\n\n      var field = this.getField(name);\n      var fieldValue = 'value' in field ? field.value : fieldMeta.initialValue;\n      if (getValueProps) {\n        return getValueProps(fieldValue);\n      }\n      return _defineProperty({}, valuePropName, fieldValue);\n    }\n  }, {\n    key: 'getField',\n    value: function getField(name) {\n      return _extends({}, this.fields[name], {\n        name: name\n      });\n    }\n  }, {\n    key: 'getNotCollectedFields',\n    value: function getNotCollectedFields() {\n      var _this3 = this;\n\n      var fieldsName = this.getValidFieldsName();\n      return fieldsName.filter(function (name) {\n        return !_this3.fields[name];\n      }).map(function (name) {\n        return {\n          name: name,\n          dirty: false,\n          value: _this3.getFieldMeta(name).initialValue\n        };\n      }).reduce(function (acc, field) {\n        return set(acc, field.name, createFormField(field));\n      }, {});\n    }\n  }, {\n    key: 'getNestedAllFields',\n    value: function getNestedAllFields() {\n      var _this4 = this;\n\n      return Object.keys(this.fields).reduce(function (acc, name) {\n        return set(acc, name, createFormField(_this4.fields[name]));\n      }, this.getNotCollectedFields());\n    }\n  }, {\n    key: 'getFieldMember',\n    value: function getFieldMember(name, member) {\n      return this.getField(name)[member];\n    }\n  }, {\n    key: 'getNestedFields',\n    value: function getNestedFields(names, getter) {\n      var fields = names || this.getValidFieldsName();\n      return fields.reduce(function (acc, f) {\n        return set(acc, f, getter(f));\n      }, {});\n    }\n  }, {\n    key: 'getNestedField',\n    value: function getNestedField(name, getter) {\n      var fullNames = this.getValidFieldsFullName(name);\n      if (fullNames.length === 0 || // Not registered\n      fullNames.length === 1 && fullNames[0] === name // Name already is full name.\n      ) {\n          return getter(name);\n        }\n      var isArrayValue = fullNames[0][name.length] === '[';\n      var suffixNameStartIndex = isArrayValue ? name.length : name.length + 1;\n      return fullNames.reduce(function (acc, fullName) {\n        return set(acc, fullName.slice(suffixNameStartIndex), getter(fullName));\n      }, isArrayValue ? [] : {});\n    }\n  }, {\n    key: 'isValidNestedFieldName',\n\n\n    // @private\n    // BG: `a` and `a.b` cannot be use in the same form\n    value: function isValidNestedFieldName(name) {\n      var names = this.getAllFieldsName();\n      return names.every(function (n) {\n        return !partOf(n, name) && !partOf(name, n);\n      });\n    }\n  }, {\n    key: 'clearField',\n    value: function clearField(name) {\n      delete this.fields[name];\n      delete this.fieldsMeta[name];\n    }\n  }]);\n\n  return FieldsStore;\n}();\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this5 = this;\n\n  this.setFieldsInitialValue = function (initialValues) {\n    var flattenedInitialValues = _this5.flattenRegisteredFields(initialValues);\n    var fieldsMeta = _this5.fieldsMeta;\n    Object.keys(flattenedInitialValues).forEach(function (name) {\n      if (fieldsMeta[name]) {\n        _this5.setFieldMeta(name, _extends({}, _this5.getFieldMeta(name), {\n          initialValue: flattenedInitialValues[name]\n        }));\n      }\n    });\n  };\n\n  this.getAllValues = function () {\n    var fieldsMeta = _this5.fieldsMeta,\n        fields = _this5.fields;\n\n    return Object.keys(fieldsMeta).reduce(function (acc, name) {\n      return set(acc, name, _this5.getValueFromFields(name, fields));\n    }, {});\n  };\n\n  this.getFieldsValue = function (names) {\n    return _this5.getNestedFields(names, _this5.getFieldValue);\n  };\n\n  this.getFieldValue = function (name) {\n    var fields = _this5.fields;\n\n    return _this5.getNestedField(name, function (fullName) {\n      return _this5.getValueFromFields(fullName, fields);\n    });\n  };\n\n  this.getFieldsError = function (names) {\n    return _this5.getNestedFields(names, _this5.getFieldError);\n  };\n\n  this.getFieldError = function (name) {\n    return _this5.getNestedField(name, function (fullName) {\n      return getErrorStrs(_this5.getFieldMember(fullName, 'errors'));\n    });\n  };\n\n  this.isFieldValidating = function (name) {\n    return _this5.getFieldMember(name, 'validating');\n  };\n\n  this.isFieldsValidating = function (ns) {\n    var names = ns || _this5.getValidFieldsName();\n    return names.some(function (n) {\n      return _this5.isFieldValidating(n);\n    });\n  };\n\n  this.isFieldTouched = function (name) {\n    return _this5.getFieldMember(name, 'touched');\n  };\n\n  this.isFieldsTouched = function (ns) {\n    var names = ns || _this5.getValidFieldsName();\n    return names.some(function (n) {\n      return _this5.isFieldTouched(n);\n    });\n  };\n};\n\nexport default function createFieldsStore(fields) {\n  return new FieldsStore(fields);\n}"]}]}